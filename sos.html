<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SOCCORSO 118 - INVIO POSIZIONE</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        body { background-color: #dc3545; color: white; text-align: center; display: flex; flex-direction: column; justify-content: center; height: 100vh; padding: 20px; }
        .btn-sos { width: 200px; height: 200px; border-radius: 50%; font-size: 2rem; font-weight: bold; border: 10px solid rgba(255,255,255,0.3); animation: pulse 2s infinite; box-shadow: 0 10px 30px rgba(0,0,0,0.3); }
        @keyframes pulse { 0% { transform: scale(1); } 50% { transform: scale(1.05); } 100% { transform: scale(1); } }
    </style>
</head>
<body>
    <div id="step1">
        <h1 class="fw-bold mb-4">CENTRALE 118</h1>
        <p class="lead mb-5">Premi il pulsante per permetterci di localizzarti immediatamente.</p>
        <button class="btn btn-light text-danger btn-sos" onclick="sendPosition()">
            <i class="fa-solid fa-location-crosshairs"></i><br>INVIA POSIZIONE
        </button>
    </div>

    <div id="step2" style="display:none">
        <i class="fa-solid fa-circle-check fa-5x mb-4"></i>
        <h1>POSIZIONE INVIATA</h1>
        <p>Rimani fermo e attendi i soccorsi.</p>
        <p class="small mt-4 op-50">Puoi chiudere questa pagina.</p>
    </div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        import { getDatabase, ref, set } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-database.js";

        const firebaseConfig = {
            apiKey: "AIzaSyAu-Ow4yjxPCfw7SqqEAO1RyxB5cuB1TD0",
            authDomain: "mappa-118.firebaseapp.com",
            databaseURL: "https://mappa-118-default-rtdb.firebaseio.com",
            projectId: "mappa-118",
            storageBucket: "mappa-118.firebasestorage.app",
            messagingSenderId: "435041812031",
            appId: "1:435041812031:web:d7ecb90ec4f25e133a028a",
            measurementId: "G-0MH2GS1N4L"
        };

        const app = initializeApp(firebaseConfig);
        const db = getDatabase(app);

        window.sendPosition = function() {
            if (!navigator.geolocation) return alert("GPS non supportato");
            
            navigator.geolocation.getCurrentPosition((pos) => {
                set(ref(db, 'caller_location'), {
                    lat: pos.coords.latitude,
                    lng: pos.coords.longitude,
                    accuracy: pos.coords.accuracy,
                    timestamp: Date.now()
                }).then(() => {
                    document.getElementById('step1').style.display = 'none';
                    document.getElementById('step2').style.display = 'block';
                });
            }, (err) => {
                alert("Devi premere CONSENTI alla richiesta di posizione.");
            }, { enableHighAccuracy: true });
        };
    </script>
</body>
</html>